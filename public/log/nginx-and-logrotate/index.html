<!DOCTYPE HTML>

<html lang="en">
   <head>
      <title>Nginx and logrotate - An Experiment In Development</title>
      <link href="/get/style.css" rel="stylesheet" type="text/css"/>
      <link href="/feed.xml" rel="alternate" title="An Experiment In Development" type="application/rss+xml"/>
      <link rel="canonical" href="https://sush.us/log/nginx-and-logrotate/"/>
      <link rel="icon" href="/favicon.png" type="image/x-icon"/>
      <meta charset="utf-8"/>
      <meta name="author" content="Lorenzo Sapora"/>
      <meta name="description" content="Using Nginx and logrotate to keep log sizes down to a minimum. "/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:description" content="Using Nginx and logrotate to keep log sizes down to a minimum. "/>
      <meta property="og:image" content="https://sush.us/favicon.png"/>
      <meta property="og:site_name" content="SudoSushi"/>
      <meta property="og:type" content="website"/>
   </head>
   <body>
      <header>
         <h1>Nginx and logrotate</h1>
         <div class="headsub">Speed, Compress  Rotate</div>
         <nav>
            <a href="/">home</a>
            <a href="/about/">about</a>
            <a href="/contact/">contact</a>
            <a href="/portfolio/">portfolio</a>
            <a href="/log/">log</a>
         </nav>
      </header>
      <section>
         <div class="article">
            <p>An often overlooked aspect of any web server is the logs. Sure, you rush to them in your time of need when somethings gone terribly wrong, but by that time its too late and youre having to open/download/tail a massive file.<!--more--> Lets keep these files clean and ordered.</p>
            <p>Lets clean up our logs.</p>
            <p>This setup will work on nearly any debian (and debian forks such as ubuntu) setup.</p>
            <p>Heres an excerpt from my nginx config.</p>
            <figure class="code">
               <div class="highlight">
                  <table>
                     <tr>
                        <td class="gutter">
                           <pre class="line-numbers">
                              <span class="line-number">1</span>
                              <span class="line-number">2</span>
                              <span class="line-number">3</span>
                              <span class="line-number">4</span>
                              <span class="line-number">5</span>
                              <span class="line-number">6</span>
                              <span class="line-number">7</span>
                              <span class="line-number">8</span>
                              <span class="line-number">9</span>
                              <span class="line-number">10</span>
                              <span class="line-number">11</span>
                           </pre>
                        </td>
                        <td class="code">
                           <pre>
                              <code class="">
                                 <span class="line">server {
</span>
                                 <span class="line">  [...]
</span>
                                 <span class="line">  server_name sudosushi.com;
</span>
                                 <span class="line">  access_log /user/sudosushi/sudosushi-log/access.log;
</span>
                                 <span class="line">  location / {
</span>
                                 <span class="line">      root /user/sudosushi/sudosushi/public;
</span>
                                 <span class="line">      index.html;
</span>
                                 <span class="line">      [...]
</span>
                                 <span class="line">  }
</span>
                                 <span class="line">  [...]
</span>
                                 <span class="line">}</span>
                              </code>
                           </pre>
                        </td>
                     </tr>
                  </table>
               </div>
            </figure>
            <p>
               As you can see, I store my access_logs is inside
               <code>/user/sudosushi/sudosushi-log/</code>
               . This is important for the next piece.
            </p>
            <p>
               Lets head over to
               <code>/etc/logrotate.d</code>
               . If youve already installed nginx, youll have a file called nginx inside. We need to edit it.
            </p>
            <figure class="code">
               <div class="highlight">
                  <table>
                     <tr>
                        <td class="gutter">
                           <pre class="line-numbers">
                              <span class="line-number">1</span>
                           </pre>
                        </td>
                        <td class="code">
                           <pre>
                              <code class="">
                                 <span class="line">nano /etc/logrotate.d/nginx
</span>
                              </code>
                           </pre>
                        </td>
                     </tr>
                  </table>
               </div>
            </figure>
            <p>Itll have something already inside. Itll probably look like this</p>
            <figure class="code">
               <div class="highlight">
                  <table>
                     <tr>
                        <td class="gutter">
                           <pre class="line-numbers">
                              <span class="line-number">1</span>
                              <span class="line-number">2</span>
                              <span class="line-number">3</span>
                              <span class="line-number">4</span>
                              <span class="line-number">5</span>
                              <span class="line-number">6</span>
                              <span class="line-number">7</span>
                              <span class="line-number">8</span>
                              <span class="line-number">9</span>
                              <span class="line-number">10</span>
                              <span class="line-number">11</span>
                              <span class="line-number">12</span>
                              <span class="line-number">13</span>
                           </pre>
                        </td>
                        <td class="code">
                           <pre>
                              <code class="">
                                 <span class="line">/var/log/nginx/*.log {
</span>
                                 <span class="line">        daily
</span>
                                 <span class="line">        missingok
</span>
                                 <span class="line">        rotate 52
</span>
                                 <span class="line">        compress
</span>
                                 <span class="line">        delaycompress
</span>
                                 <span class="line">        notifempty
</span>
                                 <span class="line">        create 640 nginx adm
</span>
                                 <span class="line">        sharedscripts
</span>
                                 <span class="line">        postrotate
</span>
                                 <span class="line">                [ -f /var/run/nginx.pid ]  kill -USR1 `cat /var/run/nginx.pid`
</span>
                                 <span class="line">        endscript
</span>
                                 <span class="line">}</span>
                              </code>
                           </pre>
                        </td>
                     </tr>
                  </table>
               </div>
            </figure>
            <h3>Condensed version</h3>
            <p>Simply type this to get the desired result.</p>
            <figure class="code">
               <div class="highlight">
                  <table>
                     <tr>
                        <td class="gutter">
                           <pre class="line-numbers">
                              <span class="line-number">1</span>
                           </pre>
                        </td>
                        <td class="code">
                           <pre>
                              <code class="">
                                 <span class="line">nano /etc/logrotate.d/nginx
</span>
                              </code>
                           </pre>
                        </td>
                     </tr>
                  </table>
               </div>
            </figure>
            <p>Add to the end of the file</p>
            <figure class="code">
               <div class="highlight">
                  <table>
                     <tr>
                        <td class="gutter">
                           <pre class="line-numbers">
                              <span class="line-number">1</span>
                              <span class="line-number">2</span>
                              <span class="line-number">3</span>
                              <span class="line-number">4</span>
                              <span class="line-number">5</span>
                              <span class="line-number">6</span>
                              <span class="line-number">7</span>
                              <span class="line-number">8</span>
                              <span class="line-number">9</span>
                              <span class="line-number">10</span>
                              <span class="line-number">11</span>
                              <span class="line-number">12</span>
                              <span class="line-number">13</span>
                           </pre>
                        </td>
                        <td class="code">
                           <pre>
                              <code class="">
                                 <span class="line">/var/log/nginx/*.log {
</span>
                                 <span class="line">        daily
</span>
                                 <span class="line">        missingok
</span>
                                 <span class="line">        rotate 52
</span>
                                 <span class="line">        compress
</span>
                                 <span class="line">        delaycompress
</span>
                                 <span class="line">        notifempty
</span>
                                 <span class="line">        create 640 nginx adm
</span>
                                 <span class="line">        sharedscripts
</span>
                                 <span class="line">        postrotate
</span>
                                 <span class="line">                [ -f /var/run/nginx.pid ]  kill -USR1 `cat /var/run/nginx.pid`
</span>
                                 <span class="line">        endscript
</span>
                                 <span class="line">}</span>
                              </code>
                           </pre>
                        </td>
                     </tr>
                  </table>
               </div>
            </figure>
            <p> Done.</p>
            <div class="article"/>
            <h4>Appendium</h4>
            <p>
               - The
               <code>[...]</code>
               denotes that information is redacted for the sake of space, clarity or its information you dont need to know.
            </p>
            <p>
               - Nano is used in this walk through, but please dont feel you have to use it.
               <code>vi</code>
               is a better text editor, but not as friendly to the enduser as wed like. Agreed?
            </p>
         </div>
         <div class="additional-information btc">
            <div class="left">
               <h2>Found value in this post?</h2>
               <p>
                  Offer up some
                  <a href="/log/value-for-value/">value for value</a>
               </p>
               <p>
                  Bitcoin
                  <a href="">[?]</a>
                  : 1SudoSTdEaMA2fqBkJ7rmZ1E14D4LsRFf or
                  <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=CFQT7HP58CBG6">PayPal</a>
               </p>
            </div>
         </div>
      </section>
      <div class="additional-information">
         Edit history:
         <a href="https://git.knowbl.co/dev/sush-us/commits/master/www/source/_posts/2013-07-08-nginx-and-logrotate.markdown">Nginx and logrotate history</a>
      </div>
      <div class="additional-information">
         <a class="left" href="/log/octodad-goodies/" title="Next Post: Octodad Goodies">
            <svg version="1.1" id="al" x="0px" y="0px" viewBox="0 0 477.175 477.175" style="enable-background:new 0 0 477.175 477.175;" xml:space="preserve">
               <path d="M360.731,229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1,0s-5.3,13.8,0,19.1l215.5,215.5l-215.5,215.5   c-5.3,5.3-5.3,13.8,0,19.1c2.6,2.6,6.1,4,9.5,4c3.4,0,6.9-1.3,9.5-4l225.1-225.1C365.931,242.875,365.931,234.275,360.731,229.075z"/>
            </svg>
            Octodad Goodies
         </a>
         <a class="right" href="/log/magento-connect-permissions/" title="Previous Post: Magento Connect Permissions">
            Magento Connect Permissions
            <svg version="1.1" id="ar" x="0px" y="0px" viewBox="0 0 477.175 477.175" style="enable-background:new 0 0 477.175 477.175;" xml:space="preserve">
               <path d="M360.731,229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1,0s-5.3,13.8,0,19.1l215.5,215.5l-215.5,215.5   c-5.3,5.3-5.3,13.8,0,19.1c2.6,2.6,6.1,4,9.5,4c3.4,0,6.9-1.3,9.5-4l225.1-225.1C365.931,242.875,365.931,234.275,360.731,229.075z"/>
            </svg>
         </a>
      </div>
   </body>
</html>
